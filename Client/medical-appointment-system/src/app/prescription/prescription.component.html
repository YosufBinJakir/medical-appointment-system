<div class=" mt-4">
  <div class="row mb-3">
    <div class="col-md-6">
      <div class="input-group">
        <input
          type="text"
          class="form-control"
          placeholder="Search prescriptions..."
          [(ngModel)]="searchInput"
          (keyup.enter)="getPrescriptionList(1, 10, searchInput)"
        />
        <button
          class="btn btn-primary"
          type="button"
          (click)="getPrescriptionList(1, 10, searchInput)"
        >
          <i class="bi bi-search"></i> 
        </button>
      </div>
    </div>
  </div>

  <div class="table-responsive">
    <table class="table table-bordered table-striped">
      <thead class="table-light">
        <tr>
          <th>#</th>
          <th>Doctor</th>
          <th>Patient</th>
          <th>Medicine</th>
          <th>Dosage</th>

          <th>Start Date</th>
          <th>End Date</th>
          <th>Notes</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let p of prescriptions.data; let i = index">
          <td>
            {{ (pagination.currentPage - 1) * pagination.pageSize + i + 1 }}
          </td>

          <td>
            <span
              style="
                color: #007bff;
                text-decoration: none;
                cursor: not-allowed;
                pointer-events: none;
              "
            >
              {{ p.doctorName }}
            </span>
          </td>

          <!-- Patient -->
          <td>
            <span
              style="
                color: #007bff;
                text-decoration: none;
                cursor: not-allowed;
                pointer-events: none;
              "
            >
              {{ p.patientName }}
            </span>
          </td>

          <td>
            <span
              *ngIf="!isEditing(p.prescriptionDetailId, 'medicineId')"
              (click)="startEditing(p, 'medicineId')"
              style="cursor: pointer; color: #007bff; text-decoration: none"
            >
              {{ p.medicineName }}
            </span>

            <div
              *ngIf="isEditing(p.prescriptionDetailId, 'medicineId')"
              class="d-flex gap-2"
            >
              <select
                [(ngModel)]="p.medicineId"
                class="form-control form-control-sm"
              >
                <option [ngValue]="null">Select Medicine</option>
                <option *ngFor="let m of medicines" [ngValue]="m.medicineId">
                  {{ m.medicineName }}
                </option>
              </select>
            </div>
          </td>

          <td>
            <input type="text" [(ngModel)]="p.dosage" class="form-control" />
          </td>

          <td>
            <input
              type="datetime-local"
              [(ngModel)]="p.startDate"
              class="form-control"
            />
          </td>
          <td>
            <input
              type="datetime-local"
              [(ngModel)]="p.endDate"
              class="form-control"
            />
          </td>
          <td>
            <input type="text" [(ngModel)]="p.notes" class="form-control" />
          </td>
          <td>
            <div class="d-flex">
              <button
                type="button"
                style="color: green"
                class="btn"
                (click)="savePrescription(p.prescriptionDetailId, p)"
                [disabled]="!p.prescriptionDetailId"
                title="Save changes"
              >
                <i class="bi bi-database-fill-add"></i>
              </button>
              <button class="btn" (click)="cancelEditing(p)">
                <i class="bi bi-arrow-clockwise"></i>
              </button>
              <button
                class="btn"
                (click)="deletePrescription(p.prescriptionDetailId)"
              >
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </td>
        </tr>


        <tr *ngIf="prescriptions.data.length === 0">
          <td colspan="10" class="text-center">No prescriptions found</td>
        </tr>
      </tbody>
    </table>
  </div>
  <span>TotalPages: {{pagination.totalPages}}</span>
  <nav  *ngIf="pagination">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="!pagination.hasPrevious">
        <a
          class="page-link"
          (click)="
            getPrescriptionList(
              pagination.currentPage - 1,
              pagination.pageSize,
              searchInput
            )
          "
        >
          Previous
        </a>
      </li>

      <li
        class="page-item"
        *ngFor="
          let page of [].constructor(pagination.totalPages);
          let p = index
        "
        [class.active]="p + 1 === pagination.currentPage"
      >
        <a
          class="page-link"
          (click)="getPrescriptionList(p + 1, pagination.pageSize, searchInput)"
        >
          {{ p + 1 }}
        </a>
      </li>

      <li class="page-item" [class.disabled]="!pagination.hasNext">
        <a
          class="page-link"
          (click)="
            getPrescriptionList(
              pagination.currentPage + 1,
              pagination.pageSize,
              searchInput
            )
          "
        >
          Next
        </a>
      </li>
    </ul>
  </nav>
  
</div>
